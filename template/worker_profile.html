{% extends 'base.html' %}
{% load static %}

{% block title %}My Profile - SideCrew{% endblock %}

{% block styles %}
{# We don't need the hero-bg style for this page.
   All other styles from base.html will still apply. #}
<style>
    /* A little helper to make the file input look nicer */
    .file-input-label {
        cursor: pointer;
    }
    .file-input-hidden {
        display: none;
    }
    /* Style for the availability toggle */
    .toggle-checkbox:checked {
        right: 0;
        border-color: #4A90E2;
    }
    .toggle-checkbox:checked + .toggle-label {
        background-color: #4A90E2;
    }
    /* Read-only field style */
    .readonly-field {
        background-color: #f4f5f7;
        color: #5e6c84;
        padding: 0.6rem 0.75rem;
        border-radius: 0.375rem;
        border: 1px solid #dfe1e6;
    }
</style>
{% endblock %}


{% block content %}

    <section class="py-20 bg-slate-100">
        <div class="container mx-auto px-6 max-w-4xl">

            <div class="text-center mb-12">
                <div class="inline-flex items-center justify-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10 text-blue-600">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-800">My Profile</h2>
                </div>
                <p class="mt-4 text-lg text-slate-600">
                    View and update your account details.
                </p>
            </div>

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="bg-white rounded-lg shadow-xl overflow-hidden">

                    <div class="p-6 md:p-10">

                        <div class="md:flex items-center gap-8 mb-8">
                            
                            {% if worker.profile_pic %}
                                <img src="{{ worker.profile_pic.url }}" alt="{{ worker.name }}'s profile picture"
                                     class="w-32 h-32 rounded-full mx-auto md:mx-0 object-cover mb-4 md:mb-0 ring-4 ring-blue-100 p-1">
                            {% else %}
                                <div class="w-32 h-32 rounded-full mx-auto md:mx-0 bg-slate-200 flex items-center justify-center text-slate-500 mb-4 md:mb-0 text-sm font-medium ring-4 ring-slate-200">
                                    No Photo
                                </div>
                            {% endif %}

                            <div class="text-center md:text-left flex-1">
                                <div class="flex items-center gap-2 text-center md:text-left">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-slate-700">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.04l-.821 1.316z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" />
                                    </svg>
                                    <h3 class="text-lg font-semibold text-slate-800">Change Profile Picture</h3>
                                </div>
                                <p class="text-sm text-slate-500 mt-1 mb-4">Upload a new photo for your profile (max 2MB).</p>
                                
                                <label for="profile_pic" class="file-input-label inline-flex items-center gap-2 bg-blue-50 text-blue-700 hover:bg-blue-100 font-semibold py-2 px-4 rounded-md text-sm transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                        <path d="M10.75 4.75a.75.75 0 00-1.5 0v8.614L6.295 10.23a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 10-1.09-1.03l-2.955 3.134V4.75z" />
                                        <path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z" />
                                    </svg>
                                    <span>Choose a file</span>
                                </label>
                                <input type="file" name="profile_pic" id="profile_pic" class="file-input-hidden" accept="image/*">
                            </div>
                        </div>

                        <hr class="border-slate-200 my-8">

                        <h3 class="text-xl font-semibold text-slate-800 mb-6">Account Details</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">

                            <div>
                                <label for="name" class="block text-sm font-medium text-slate-700">Full Name</label>
                                <div class="relative mt-1">
                                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-slate-400">
                                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zM6.024 11.478a.75.75 0 10-1.047 1.053 4.5 4.5 0 008.046 0 .75.75 0 10-1.047-1.053 3 3 0 01-6 0zM10 3a.75.75 0 00-1.45.105A.75.75 0 0010 3zm4.475 8.478a.75.75 0 10-1.047-1.053 3 3 0 00-6 0 .75.75 0 10-1.047 1.053 4.5 4.5 0 018.046 0z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <input type="text" name="name" id="name" value="{{ worker.name }}"
                                           class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 pl-10">
                                </div>
                            </div>
                            
                            <div>
                                <label for="phone" class="block text-sm font-medium text-slate-700">Phone Number</label>
                                <div class="relative mt-1">
                                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-slate-400">
                                            <path fill-rule="evenodd" d="M2 3.5A1.5 1.5 0 013.5 2h1.148a1.5 1.5 0 011.465 1.175l.716 3.223a1.5 1.5 0 01-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 006.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 011.767-1.052l3.223.716A1.5 1.5 0 0118 15.352V16.5a1.5 1.5 0 01-1.5 1.5h-1.5A13.5 13.5 0 012 3.5z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <input type="tel" name="phone" id="phone" value="{{ worker.phone|default_if_none:'' }}"
                                           class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 pl-10"
                                           placeholder="e.g., +91 98765 43210">
                                </div>
                            </div>

                            <div class="md:col-span-2">
                                <label for="email" class="block text-sm font-medium text-slate-700">Email Address</label>
                                <div class="relative mt-1">
                                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-slate-400">
                                            <path d="M3 4a2 2 0 00-2 2v1.161l8.441 4.221a1.25 1.25 0 001.118 0L19 7.161V6a2 2 0 00-2-2H3z" />
                                            <path d="M19 8.839l-7.77 3.885a2.75 2.75 0 01-2.46 0L1 8.839V14a2 2 0 002 2h14a2 2 0 002-2V8.839z" />
                                        </svg>
                                    </div>
                                    <input type="email" name="email" id="email" value="{{ worker.email }}"
                                           class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 pl-10">
                                </div>
                            </div>

                            <div class="md:col-span-2">
                                <label for="address" class="block text-sm font-medium text-slate-700">Address</label>
                                <div class="relative mt-1">
                                    <div class="pointer-events-none absolute left-3 top-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-slate-400">
                                            <path fill-rule="evenodd" d="M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.1.4-.223.615-.371a.636.636 0 00.226-.219l4.28-4.28a6.5 6.5 0 000-9.192 6.5 6.5 0 00-9.192 0A6.5 6.5 0 005.14 9.515l4.28 4.28.001.001c.066.065.14.13.226.219.215.148.43.27.615.371.094.05.19.095.281.14l.018.008.006.003zM10 11.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <textarea name="address" id="address" rows="3"
                                              class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 pl-10 pt-2"
                                              placeholder="123 Main St, Anytown, USA">{{ worker.address|default_if_none:'' }}</textarea>
                                </div>
                            </div>

                            <div class="md:col-span-2">
                                <label for="skills" class="block text-sm font-medium text-slate-700">Skills</label>
                                <div class="relative mt-1">
                                    <div class="pointer-events-none absolute left-3 top-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-slate-400">
                                            <path fill-rule="evenodd" d="M11.49 3.17c.123-.08.248-.15.378-.208a.75.75 0 01.848.208l1.106 1.106a.75.75 0 01.208.848c-.058.13-.128.255-.208.378a.75.75 0 01-.52.52c-.123.08-.248.15-.378.208a.75.75 0 01-.848-.208l-1.106-1.106a.75.75 0 01-.208-.848c.058-.13.128-.255.208-.378zM3.17 11.49c-.08.123-.15.248-.208.378a.75.75 0 00.208.848l1.106 1.106a.75.75 0 00.848.208c.13-.058.255-.128.378-.208a.75.75 0 00.52-.52c.08-.123.15-.248.208-.378a.75.75 0 00-.208-.848l-1.106-1.106a.75.75 0 00-.848-.208c-.13.058-.255.128-.378.208a.75.75 0 00-.52.52z" clip-rule="evenodd" />
                                            <path d="M10 5.25a.75.75 0 01.75.75v.008l.006.002a7.48 7.48 0 014.22 2.686.75.75 0 11-1.06 1.06 5.98 5.98 0 00-3.172-2.112l-.003-.001A.75.75 0 0110 7.5v-.008l-.006-.002a7.48 7.48 0 01-4.22 2.686.75.75 0 01-1.06-1.06 5.98 5.98 0 003.172-2.112l.003-.001A.75.75 0 0110 5.25zM4.94 18.06l-.003.002c.002.002.003.003.005.005l.01.008a6.038 6.038 0 003.926 2.31.75.75 0 10.2-1.484 4.538 4.538 0 01-2.936-1.728l-.008-.01a.75.75 0 00-1.2 1.098zM15.06 18.06l.003.002c-.002.002-.003.003-.005.005l-.01.008a6.038 6.038 0 01-3.926 2.31.75.75 0 10-.2-1.484 4.538 4.538 0 002.936-1.728l.008-.01a.75.75 0 10-1.2-1.098z" />
                                        </svg>
                                    </div>
                                    <textarea name="skills" id="skills" rows="3"
                                              class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 pl-10 pt-2"
                                              placeholder="e.g., Plumbing, Data Entry, Graphic Design">{{ worker.skills|default_if_none:'' }}</textarea>
                                </div>
                            </div>
                            
                            <hr class="md:col-span-2 border-slate-200 my-3">

                            <div>
                                <label for="availability" class="block text-sm font-medium text-slate-700">Availability</label>
                                <div class="relative inline-block w-10 mt-2 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" name="availability" id="availability"
                                           class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"
                                           {% if worker.availability %}checked{% endif %} value="on"/>
                                    <label for="availability" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                </div>
                                <span class="ml-3 text-sm text-slate-600">Available for work</span>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-700">Rating</label>
                                <div class="relative mt-1">
                                    <div class="readonly-field flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-amber-500">
                                            <path fill-rule="evenodd" d="M10.868 2.884c.321-.772 1.415-.772 1.736 0l1.83 4.401 4.79 1.164c.9.22 1.267 1.24.556 1.847l-3.328 3.538 1.17 4.87a1.176 1.176 0 01-1.664 1.29l-4.151-2.43-4.151 2.43a1.176 1.176 0 01-1.664-1.29l1.17-4.87-3.328-3.538c-.711-.607-.344-1.627.556-1.847l4.79-1.164 1.83-4.401z" clip-rule="evenodd" />
                                        </svg>
                                        <span>{{ worker.rating|floatformat:1 }} / 5.0</span>
                                    </div>
                                </div>
                            </div>

                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-slate-700">Account Status</label>
                                <div class="relative mt-1">
                                    <div class="readonly-field flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-slate-500">
                                          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15h.506a1.75 1.75 0 001.74-1.13l.459-2.066a.25.25 0 01.244-.304H14a.75.75 0 000-1.5H9z" clip-rule="evenodd" />
                                        </svg>
                                        <span class="font-medium">{{ worker.status|title }}</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="bg-slate-50 p-6 border-t border-slate-200 flex flex-col-reverse sm:flex-row sm:justify-between sm:items-center gap-4">

                        <a href="{% url 'delete_worker_profile' %}"
                           class="w-full sm:w-auto text-center bg-red-600 hover:bg-red-700 text-white font-medium py-2.5 px-5 rounded-md text-sm transition-colors flex items-center justify-center gap-2"
                           onclick="return confirm('Are you sure you want to permanently delete your profile? This action cannot be undone.')">
                           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193v-.443A2.75 2.75 0 0011.25 1h-2.5zM10 4c.839 0 1.67.017 2.5.051v-.301A1.25 1.25 0 0011.25 2.5h-2.5A1.25 1.25 0 007.5 3.75v.3c.83.034 1.661.051 2.5.051zM8.293 8.293a1 1 0 011.414 0L10 8.586l.293-.293a1 1 0 111.414 1.414L11.414 10l.293.293a1 1 0 01-1.414 1.414L10 11.414l-.293.293a1 1 0 01-1.414-1.414L8.586 10l-.293-.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                           </svg>
                           <span>Delete Profile</span>
                        </a>

                        <button type="submit"
                                class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-6 rounded-md text-sm transition-colors flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                            </svg>
                            <span>Save Changes</span>
                        </button>
                    </div>

                </div>
            </form>

        </div>
    </section>

{% endblock %}